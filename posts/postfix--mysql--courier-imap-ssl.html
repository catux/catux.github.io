<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Associació d'usuaris de GNU/Linux de la Catalunya Central">
    <meta name="keywords" content="gnu/linux, linux, programari lliure, gnu, lug, associacio, manresa, sant joan de vilatorrada, catalan, català, catalunya">
    <meta name="author" content="Catux">
    <link rel="icon" href="https://catux.org/images/favicon.ico">

    <title>Catux - Associació d'usuaris de GNU/Linux de la Catalunya Central</title>

    <!-- Bootstrap 5 CSS is included in main.css -->
    <link rel="stylesheet" type="text/css" href="https://catux.org/css/main.css">
    <!-- Bootstrap 5 JS and dependencies are included in main.js -->
    <script src="https://catux.org/js/main.js" defer></script>
</head>
<body>
    <header class="sticky-top">
        <nav class="navbar navbar-expand-lg navbar-dark bg-dark py-3">
            <div class="container-fluid">
                <a class="navbar-brand" href="https://catux.org/">
                    <img src="https://catux.org/images/catuxlogo.png" alt="Catux" height="50" class="me-3">
                    <div class="d-none d-lg-block">Associació d'usuaris de GNU/Linux de la Catalunya Central</div>
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain" aria-controls="navbarMain" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div id="navbarMain" class="collapse navbar-collapse">
                    <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                        <li class="nav-item"><a class="nav-link px-3" href="https://catux.org/post_list.html">Blog</a></li>
                        <li class="nav-item"><a class="nav-link px-3" href="https://catux.org/traduccio.html">Traducció</a></li>
                        <li class="nav-item"><a class="nav-link px-3" href="https://catux.org/contactar.html">Contactar</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="container main-container">
        
    <div class="container-fluid">

        <div class="post">
            <a href="https://catux.org/post_list.html">
                <i class="fas fa-chevron-left"></i>
                Arxius
            </a>

            <h1>
                
        Postfix + Mysql + Courier-imap-ssl
    
            </h1>

            <h3>
                Escrit al
                
        2004-04-05 00:00:00
    
                per
                
        whats_up
    
            </h3>

            <p>
                
        En aquest article intentar&eacute; explicar com muntar un sistema de correu 100% en woody for&ccedil;a complet. Suposo que ser&agrave; de gran ajut ja que ens la meva recerca, vaig trobar poca cosa que valgu&eacute;s realment la pena, i no cal dir, en catal&agrave; ni somiar-ho!El nostre sistema de correu, tindr&agrave; molts usuaris, per tant &eacute;s inviable fer-ho sense cap tipus de &ldquo;suport&rdquo; a l&#39;hora de gestionar els usuaris. Si ho f&eacute;ssim &quot;a pel&quot;, el que passaria &eacute;s que tindr&iacute;em un /etc/passwd de un &quot;coll&oacute;&quot; de files. Per solucionar aquest problema, he triat la genial base de dades MySQL. Per oferir comoditat i seguretat als usuaris tractant els seus correus, posarem IMAP-SSL. Al utilitzar aquest sistema podrem tenir una infinitat d&#39;usuaris amb comptes de correu sense haber de tenir compta local al sistema, ser&agrave;n usuaris virtuals.<br /><div id="article" class="article_normal"> <br /> En principi amb aquest article, n&#39;haur&iacute;eu de tenir prou per muntar el sistema de correu una mica complet, que tindr&agrave; el servidor de correu (Postfix), una base de dades (MySQL) per gestionar tots els usuaris, i un sistema de treballar amb el correu directament sobre el servidor de forma segura (IMAP_SSL).<br /> <br /> Aquest article, es basa nom&eacute;s en la distribuci&oacute; estable de Debian (woody), i nom&eacute;s utilitzarem (de moment) paquets precompilats per muntar el nostre servidor. <br /> <br /> <br /> <br /> <h2>MYSQL</h2><br /> Primer de tot comen&ccedil;arem per la base de dades, ja que potser es el m&eacute;s independent.<br /> Necessitarem els paquets del servidor i del client, per tant:<br /> <br />     apt-get install mysql-server mysql-client<br /> <br /> I ja els tenim instal&middot;lats! :)<br /> <br /> Ara anirem a crear una base de dades i un usuari que la pugui manegar. Si teniu l&#39;Apache i el PHP recomano instal&middot;lar un paquet que s&#39;anomena phpmyadmin que us servir&agrave; per manejar les bases de dades de forma gr&agrave;fica i amb un gran potencial<br /> <br /> Ens connectem a la base de dades..<br /> <br />     bunker:~# mysql -h localhost -u root -p<br /> <br /> (la contrasenya per defecte est&agrave; en blanc)<br /> <br />     Welcome to the MySQL monitor. Commands end with ; or \g.<br />     Your MySQL connection id is 462 to server version: 3.23.49-log<br /> <br />     Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the buffer.<br /> <br />     mysql&gt; <br /> <br /> crearem una base de dades que s&#39;anomenar&agrave; correu:<br /> <br />     mysql&gt; create database correu;<br />     Query OK, 1 row affected (0.04 sec) <br /> <br /> mirem que s&#39;hagi creat<br /> <br /> mysql&gt; show databases<br /> +----------+<br /> | Database |<br /> +----------+<br /> | correu |<br /> | mysql |<br /> | test |<br /> +----------+<br /> 3 rows in set (0.00 sec)<br /> <br /> Creem la taula &ldquo;passwd&rdquo; ens la que hi tindrem totes les dades:<br /> <br />     mysql&gt;use correu;<br />     mysql&gt;create table passwd(<br />     id char(128)DEFAULT &#39;&#39; NOT NULL,<br />     crypt char(32)DEFAULT &#39;&#39; NOT NULL,<br />     name char(32)DEFAULT &#39;&#39; NOT NULL,<br />     uid int(10) unsigned NOT NULL,<br />     gid int(10) unsigned NOT NULL,<br />     home char(255)DEFAULT &#39;&#39; NOT NULL,<br />     maildir char(255)DEFAULT &#39;&#39; NOT NULL,<br />     KEY id (id(128))<br />     );<br /> <br />     Query OK, 0 rows affected (0.00 sec) <br /> <br /> Mirem com ens ha quedat la taula..<br /> <br />     mysql&gt; describe passwd;<br /> <br />     +---------+------------------+------+-----+---------+-------+<br />     | Field | Type | Null | Key | Default | Extra |<br />     +---------+------------------+------+-----+---------+-------+<br />     | id | char(128) | | MUL | | |<br />     | crypt | char(32) | | | | |<br />     | name | char(32) | | | | |<br />     | uid | int(10) unsigned | | | | |<br />     | gid | int(10) unsigned | | | | |<br />     | home | char(255) | | | | |<br />     | maildir | char(255) | | | | |<br />     +---------+------------------+------+-----+---------+-------+<br />     7 rows in set (0.00 sec)<br /> <br /> Creen la taula que ens servir&agrave; per establir alias:<br /> <br /> mysql&gt;CREATE TABLE aliases (<br /> alias varchar(128) NOT NULL default &#39;&#39;,<br /> rcpt varchar(255) NOT NULL default &#39;&#39;<br /> ) TYPE=MyISAM;<br /> <br /> Mirem com ens ha quedat la taula..<br /> <br /> mysql&gt; describe aliases;<br /> <br /> +-------+--------------+------+-----+---------+-------+<br /> | Field | Type | Null | Key | Default | Extra |<br /> +-------+--------------+------+-----+---------+-------+<br /> | alias | varchar(128) | | | | |<br /> | rcpt | varchar(255) | | | | |<br /> +-------+--------------+------+-----+---------+-------+<br /> 2 rows in set (0.01 sec)<br /> <br /> Creem la taula transport que ens servir&agrave; per a encaminar cap a dominis o subdominis (en aquest article no l&#39;utilitzarem):<br /> <br /> mysql&gt; CREATE TABLE transport (<br /> id int(11) NOT NULL auto_increment,<br /> domain varchar(128) NOT NULL default &#39;&#39;,<br /> destination varchar(128) NOT NULL default &#39;&#39;,<br /> PRIMARY KEY (id),<br /> UNIQUE KEY domain (domain)<br /> ) TYPE=MyISAM;<br /> <br /> Mirem com ens ha quedat..<br /> <br /> mysql&gt; describe transport;<br /> +-------------+--------------+------+-----+---------+----------------+<br /> | Field | Type | Null | Key | Default | Extra |<br /> +-------------+--------------+------+-----+---------+----------------+<br /> | id | int(11) | | PRI | NULL | auto_increment |<br /> | domain | varchar(128) | | UNI | | |<br /> | destination | varchar(128) | | | | |<br /> +-------------+--------------+------+-----+---------+----------------+<br /> 3 rows in set (0.00 sec)<br /> <br /> Creem la taula relocated, que ens servir&agrave; per anunciar si algun usuari del nostre sistema s&#39;ha canviat de direcci&oacute; de correu (tampoc l&#39;utilitzarem en aquest article):<br /> <br /> mysql&gt; CREATE TABLE relocated (<br /> id int(11) NOT NULL auto_increment,<br /> email varchar(128) NOT NULL default &#39;&#39;,<br /> destination varchar(128) NOT NULL default &#39;&#39;,<br /> PRIMARY KEY (id)<br /> ) TYPE=MyISAM;<br /> <br /> Mirem com ens ha quedat..<br /> <br /> +-------------+--------------+------+-----+---------+----------------+<br /> | Field | Type | Null | Key | Default | Extra |<br /> +-------------+--------------+------+-----+---------+----------------+<br /> | id | int(11) | | PRI | NULL | auto_increment |<br /> | email | varchar(128) | | | | |<br /> | destination | varchar(128) | | | | |<br /> +-------------+--------------+------+-----+---------+----------------+<br /> 3 rows in set (0.00 sec)<br /> <br /> Ara crearem un usuari que tingui tots els permisos a aquestes taules:<br /> <br />     mysql&gt; GRANT ALL ON correu.passwd TO postfix@localhost IDENTIFIED BY &quot;pass_per_l&#39;user_postfix&quot;;<br />     mysql&gt; GRANT ALL ON correu.aliases TO postfix@localhost IDENTIFIED BY &quot;pass_per_l&#39;user_postfix&quot;;<br />     mysql&gt; GRANT ALL ON correu.transport TO postfix@localhost IDENTIFIED BY &quot;pass_per_l&#39;user_postfix&quot;;<br />     mysql&gt; GRANT ALL ON correu.relocated TO postfix@localhost IDENTIFIED BY &quot;pass_per_l&#39;user_postfix&quot;;<br /> <br /> <br /> Inserim 2 entrades d&#39;exemple per a les nostres proves, hem de tenir en compte que el tros de l&#39;id avans de @ ha de ser igual al nom d&#39;usuari:<br /> <br />     mysql&gt;insert into passwd (id,crypt,name,uid,gid,home,maildir)<br />     values(&quot;sarrio@salles.mine.nu&quot;,encrypt(&#39;password&#39;),&quot;sarrio&quot;,<br />     &quot;1001&quot;,&quot;8&quot;,&quot;/&quot;,&quot;/var/spool/mail/sarrio/Maildir/&quot;);<br /> <br />     Query OK, 1 row affected (0.01 sec)<br /> <br /> <br />     mysql&gt;insert into passwd (id,crypt,name,uid,gid,home,maildir)<br />     values(&quot;ferran@salles.mine.nu&quot;,encrypt(&#39;password&#39;),&quot;ferran&quot;,<br />     &quot;1002&quot;,&quot;8&quot;,&quot;/&quot;,&quot;/var/spool/mail/ferran/Maildir/&quot;);<br /> <br />     Query OK, 1 row affected (0.00 sec) <br /> <br /> Mirem com ens ha quedat la cosa...<br /> <br />     mysql&gt; select * from passwd;<br />     +-----------------------+----------+--------+------+-----+------+---------------------------------+<br />     | id | crypt | name | uid | gid | home | maildir |<br />     +-----------------------+----------+--------+------+-----+------+---------------------------------+<br />     | sarrio@salles.mine.nu | password | sarrio | 1001 | 8 | / | /var/spool/mail/sarrio/Maildir/ |<br />     | ferran@salles.mine.nu | password | ferran | 1002 | 8 | / | /var/spool/mail/ferran/Maildir/ |<br />     +-----------------------+----------+--------+------+-----+------+---------------------------------+<br />     2 rows in set (0.00 sec)<br /> <br /> Ara afagirem alguns aliases necessaris:<br /> <br /> #El del administrador del sistema de correu<br /> mysql&gt;insert into aliases (alias,rcpt) values(&quot;postmaster&quot;,&quot;sarrio@salles.mine.nu&quot;);<br /> #Creem com una llista de distribuci&oacute;, al enviar un correu a llista@salles.mine.nu, el rebran tots els usuaris que apareixen a rcpt<br /> mysql&gt;insert into aliases (alias,rcpt) values(&quot;llista&quot;,&quot;usuari1@salles.mine.nu, usuari2@terra.es, usuari3@hotmail.com&quot;);<br /> #Creem un alias de tota la vida. En cas que a alias aoaregui un altre domini, (ex: wekk.net) haurem de posar aquest domini<br /> #a mydestination del main.cf perqu&egrave; funcioni.<br /> mysql&gt;insert into aliases (alias,rcpt) values(&quot;Sarri@wekk.net&quot;,&quot;sarrio@salles.mine.nu&quot;);<br /> <br /> Ja l&#39;hem acabat, ja podem sortir:<br /> <br />     mysql&gt; quit<br />     Bye <br /> <br /> Una cosa important a fer, seria canviar la contrasenya del root, ja que per defecte et ve en blanc.<br /> <br /> Ho podeu fer escrivint aix&ograve; estant dins..<br />     <br /> mysql&gt; SET PASSWORD FOR root@localhost=password(&#39;la_nova_contrasenya&#39;);<br />     mysql&gt; FLUSH PRIVILEGES;<br /> <br /> Ara ja tenim la base de dades creada, amb els usuaris ben posats, per tant ja podem anar cap al Postfix! <br /> <br /> Fins aqu&iacute; l&#39;apartat de la nostre base de dades!<br /> <br /> <br /> <br /> <h2>POSTFIX</h2><br /> Necessitarem els paquets del programa i el suport per el MySQL, per tant:<br /> <br />     apt-get install postfix postfix-ldap postfix-mysql postfix-pcre<br /> <br /> Un cop instal&middot;lats anirem al directori de configuraci&oacute; del programa /etc/postfix i modificarem els seg&uuml;ents arxius:<br /> <br />     <li><strong>main.cf</strong><br />     (aquest arxiu &eacute;s l&#39;arxiu principal de configuraci&oacute; de Postfix)<br /> <br />     #Com que les opcions parlen bastant per elles soles, explicar&eacute; nom&eacute;s les<br />     #m&eacute;s importants, o les que &eacute;s m&eacute;s f&agrave;cil que hageu de canviar<br /> <br />     ###########################<br />     # ubicaci&oacute; dels directoris #<br />     ###########################<br />     queue_directory = /var/spool/postfix<br />     command_directory = /usr/sbin<br />     daemon_directory = /usr/lib/postfix<br />     program_directory = /usr/lib/postfix<br />     mail_spool_directory = /var/spool/mail/<br /> <br />     #propietari del proc&egrave;s<br />     mail_owner = postfix<br />     #el nom de la vostre m&agrave;quina<br />     myhostname = salles.mine.nu<br />     #el lloc per defecte des de on s&#39;enviaran els mails<br />     myorigin = $myhostname<br /> <br />     #control de correu entrant/sortint<br />     #quan el postfix rebi un correu, mirar&agrave; aquesta variable, si la destinaci&oacute;<br />     #del correu est&agrave; entre aquests hosts, se&#39;l quedar&agrave;, i l&#39;intentar&agrave; entregar,<br />     #ja que voldr&agrave; dir que ell &eacute;s el servidor de correu d&#39;aquestes direccions<br />     #i que el correu &eacute;s per un usuari dels que tenim a la base de dades<br />     mydestination = salles.mine.nu, localhost, localhost.localdomain, salles , crade.shacknet.nu, elizir.mine.nu wekk.net<br /> <br />     #aqu&iacute; &eacute;s on li dius quines maquines poden enviar correus (pot fer un relay)<br />     #que seran les mateixes que les que estan a $mydestination<br />     relay_domains = $mydestination<br /> <br />     #definir quines ip&#39;s formen part de la teva xarxa (&uacute;til per despr&eacute;s)<br />     mynetworks = 192.168.1.0/24<br /> <br />     ###########################<br />     # mysql #<br />     ###########################<br />     virtual_mailbox_base=/<br />     virtual_mailbox_maps=mysql:/etc/postfix/mysql_virt.cf<br />     virtual_uid_maps=mysql:/etc/postfix/ids.cf<br />     virtual_gid_maps=mysql:/etc/postfix/gids.cf<br />     local_transport = virtual<br />     virtual_maps = mysql:/etc/postfix/aliases.cf<br /> <br /> <br />     ############################<br />     # alguns altres parametres de configuraci&oacute; #<br />     ############################<br /> <br />     #Moltes d&#39;aquestes opcions ja et venen definides per defecte, i poden ser innecessaries.<br />     disable_vrfy_command = yes<br />     message_size_limit = 10485760<br />     mailbox_size_limit = 0<br /> <br />     #a aquesta opci&oacute; hi posem Maildir perqu&egrave; &eacute;s la que m&eacute;s ens interessa.<br />     #Aix&ograve; el que far&agrave; ser&agrave; permetre al client(l&#39;usuari de la compte de correu)<br />     #guardar en diferents carpetes tots els seus correus per tenir-los m&eacute;s<br />     #ordenats. Fins ara, es solien anar guardant tots els correus en un arxiu, un<br />     #a continuaci&oacute; de l&#39;altre, i si el client en volia baixar un, s&#39;havia de baixar<br />     #tot l&#39;arxiu. Amb aquest sistema el client nom&eacute;s es baixa els correus que vol<br />     #llegir<br />     home_mailbox = Maildir/<br /> <br />     smtpd_banner = $myhostname ESMTP server<br />     maximal_queue_lifetime = 5d<br />     #Ens notificar&agrave; entre altres coses quan alg&uacute; intenti fer servir el nostre sistema per enviar spam<br />     notify_classes = resource, software, policy<br />     smtpd_helo_required = yes<br />     local_destination_concurrency_limit = 2<br />     default_destination_concurrency_limit = 10<br /> <br />     #Opci&oacute; per a debugaci&oacute;. Us la deixo aqui per si alg&uacute; t&eacute; problemes.<br />     #debug_peer_level = 2<br /> <br />     #I si alg&uacute; est&agrave; intentant adaptar aquest article per el postfix2...<br />     #IDENTIFICACIO D&#39;USUARIS LOCALS (&eacute;s obligatori amb el postfix 2)<br />     #local_recipient_maps = $alias_maps unix:passwd.byname<br /> <br /> Ara hem de crear els arxius on li diem a quina base de dades, taula i columna est&agrave; cada dada, heu d&#39;anar en compte de no deixar espais darrere del password, que sino m&eacute;s d&#39;un s&#39;estar&agrave; trencant les banyes per una tonteria com aquesta.<br /> <br />     </li><li><strong>gids.cf</strong><br /> <br />     #Usuari i contrasenya per accedir al servidor MySQL<br />     user=postfix<br />     password=pass_per_l&#39;user_postfix<br />     #Nom de la base de dades i la taula<br />     dbname=correu<br />     table=passwd<br />     #El camp d&#39;on tr&egrave;iem el gid<br />     select_field=gid<br />     where_field=id<br />     #El host que t&eacute; el MySQL. Nosaltres ens connectarem via socket perqu&egrave; aix&iacute;<br />     #no ens cal haver de tenir el MySQL escoltant a l&#39;exterior<br />     hosts=unix:mysqld.sock <br /> <br /> <br />     </li><li><strong>ids.cf</strong><br /> <br />     #Usuari i contrassenya per accedir al servidor MySQL<br />     user=postfix<br />     password=pass_per_l&#39;user_postfix<br />     #Nom de la base de dades i la taula<br />     dbname=correu<br />     table=passwd<br />     #El camp d&#39;on traiem el uid<br />     select_field=uid<br />     where_field=id<br /> #El host que t&eacute; el MySQL. Nosaltres ens connectarem via socket perqu&egrave; aix&iacute; no ens cal haver de tenir el MySQL escoltant a l&#39;exterior<br />     hosts=unix:mysqld.sock <br /> <br /> <br /> </li><li><strong>aliases.cf</strong><br /> <br /> #Usuari i contrassenya per accedir al servidor MySQL<br /> user=postfix<br /> password=pass_per_l&#39;user_postfix<br /> #Nom de la base de dades i la taula<br /> dbname=correu<br /> table=aliases<br /> #Particularitats de la taula<br /> select_field=rcpt<br /> where_field=alias<br /> #El host que t&eacute; el MySQL. Nosaltres ens connectarem via socket perqu&egrave; aix&iacute; no ens cal haver de tenir el MySQL escoltant a l&#39;exterior<br /> hosts=unix:mysqld.sock<br /> <br /> <br />     </li><li><strong>mysql_virt.cf</strong><br /> <br />     #Usuari i contrasenya per accedir al servidor MySQL<br />     user=postfix<br />     password=pass_per_l&#39;user_postfix<br />     #Nom de la base de dades i la taula<br />     dbname=correu<br />     table=passwd<br />     #El camp que triem, ser&agrave; el que hi haur&agrave; el directori amb el nom de<br />     #l&#39;usuari pel qual siguin els correus<br />     select_field=maildir<br />     where_field=id<br />     #El host que t&eacute; el MySQL. Nosaltres ens connectarem via socket perqu&egrave; aix&iacute;<br />     #no ens cal haver de tenir el MySQL escoltant a l&#39;exterior<br />     hosts=unix:mysqld.sock <br /> <br /> Com que el Postfix s&#39;executa dins d&#39;una g&agrave;bia, per a que pugui accedir al socket del MySQL i poder treballar junts, hem de fer un enlla&ccedil; dur del socket cap al directori de treball del Postfix, per tant:<br /> <br />     ln -f /var/run/mysqld/mysqld.sock /var/spool/postfix/mysqld.sock<br /> <br /> quan re iniciem la m&agrave;quina, l&#39;enlla&ccedil; desapareixer&agrave;, el que podem fer, &eacute;s modificar l&#39;arxiu d&#39;inici del MySQL per tal de que es crei cada vegada que s&#39;inici&iuml;<br /> <br />     /etc/init.d/mysql<br /> <br />     #!/bin/sh -e<br />     #<br />     # MySQL daemon start/stop script.<br />     #<br />     # Debian version. Based on the original by TcX.<br />     #<br /> <br />     test $DEBIAN_SCRIPT_DEBUG &amp;&amp; set -v -x<br /> <br />     test -x /usr/sbin/mysqld || exit 0<br /> <br />     SELF=$(cd $(dirname $0); pwd -P)/$(basename $0)<br />     CONF=/etc/mysql/my.cnf<br />     MYADMIN=&quot;/usr/bin/mysqladmin --defaults-extra-file=/etc/mysql/debian.cnf&quot;<br /> <br />     # Safeguard (relative paths, core dumps..)<br />     cd /<br />     umask 077<br />     export PATH=/bin:/usr/bin<br /> <br />     # mysqladmin likes to read /root/.my.cnf. This is usually not what I want<br />     # as many admins e.g. only store a password without a username there and<br />     # so break my scripts.<br />     export HOME=/etc/mysql/<br /> <br />     is_mysqld_alive () {<br />     if [ -n &quot;`$MYADMIN ping 2&gt;/dev/null`&quot; ]; then return 0; else return 1; fi<br />     }<br /> <br />     case &quot;$1&quot; in<br />     &#39;start&#39;)<br />     # Start daemon<br />     echo -n &quot;Starting MySQL database server: mysqld&quot;<br />     /usr/bin/safe_mysqld &gt; /dev/null 2&gt;&amp;1 &amp;<br />     for i in 1 2 3 4 5 6; do<br />     if is_mysqld_alive; then break; fi<br />     sleep 1<br />     done<br />     if is_mysqld_alive; then<br /> <br />     #aquesta &eacute;s la l&iacute;nia que afegim:<br />     ln -f /var/run/mysqld/mysqld.sock /var/spool/postfix/mysqld.sock<br />     echo &quot;.&quot;<br />     else<br />     echo &quot;...failed.&quot;<br />     fi<br />     ;; <br /> <br /> <br /> (.......l&#39;arxiu continua....)<br /> <br /> Un cop fet aix&ograve; ens posarem a definir els permisos per els arxius de configuraci&oacute; que hem anat tocant. &Eacute;s important que nom&eacute;s els pugui llegir el Postfix per la informaci&oacute; que contenen, per tant:<br /> <br />     chmod -R 640 *<br />     chown -R root *<br />     chgrp -R postfix *<br />     chmod a+x post-install<br />     chmod a+x postfix-script<br />     chmod a+r main.cf dynamicmaps.cf <br /> <br /> <br /> <br /> <h2>IMAP</h2><br /> Per a poder oferir a l&#39;usuari una bona interf&iacute;cie per treballar amb el correu i seguretat, he triat IMAP-SSL, que al treballar amb el correu directament del servidor, ens estalviem forces possibles problemes :)<br /> <br /> Anirem per instal&middot;lar els paquets necessaris:<br /> <br />     apt-get install courier-imap courier-authmysql courier-authdaemon courier-base courier-imap-ssl courier-ssl<br /> <br /> Quan es configurin us demanaran unes dades que seran per crear els certificats.<br /> Un cop instal&middot;lats anirem per configurar-lo. Est&agrave; al directori /etc/courier<br /> <br /> El primer arxiu que modificarem ser&agrave;:<br /> <br />     </li><li><strong>authdaemonrc</strong><br /> <br />     #l&#39;&uacute;nica l&iacute;nia imprescindible, &eacute;s:<br /> <br />     authmodulelist=&quot;authmysql&quot;<br /> <br />     #per comen&ccedil;ar nom&eacute;s i deixarem aquesta, m&eacute;s endavant ja fareu les<br />     #proves ;) <br /> <br /> el segon...<br /> <br />     </li><li><strong>authmysqlrc</strong><br /> <br />     #aquest arxiu &eacute;s l&#39;important, hi ha tota la informaci&oacute; de les caselles de la base d dades<br /> <br />     MYSQL_SERVER localhost<br />     MYSQL_USERNAME postfix<br />     MYSQL_PASSWORD pass_per_l&#39;user_postfix<br />     MYSQL_PORT 3306<br />     MYSQL_OPT 0<br />     MYSQL_DATABASE correu<br />     MYSQL_USER_TABLE passwd<br />     MYSQL_CRYPT_PWFIELD crypt<br />     DEFAULT_DOMAIN salles.mine.nu<br />     MYSQL_UID_FIELD uid<br />     MYSQL_GID_FIELD gid<br />     MYSQL_LOGIN_FIELD id<br />     MYSQL_HOME_FIELD home<br />     MYSQL_NAME_FIELD name<br />     MYSQL_MAILDIR_FIELD maildir <br /> <br /> el tercer..<br /> <br />     </li><li><strong>imapd-ssl</strong><br /> <br /> No recordo si per defecte l&#39;opci&oacute; IMAPDSTARTTLS et ve a YES, si no et ve, ja li esteu posant, i amb l&#39;arxiu IMAPD al rev&eacute;s, si l&#39;opci&oacute; IMAPDSTART us ve a YES ja l&#39;esteu posant a no, perqu&egrave; el vostre sistema nom&eacute;s tindr&agrave; operatiu IMAP amb SSL :)<br /> <br /> Ara nom&eacute;s falta re iniciar cada servei:<br /> <br />     bunker:~# /etc/init.d/courier-authdaemon restart<br />     Stopping Courier authdaemon: done.<br />     Starting Courier authdaemon: done.<br /> <br />     bunker:~# /etc/init.d/courier-imap restart<br />     Stopping Courier IMAP server: imapd.<br />     Starting Courier IMAP server: imapd.<br /> <br />     bunker:~# /etc/init.d/courier-imap-ssl restart<br />     Stopping Courier IMAP-SSL server: imapd-ssl.<br />     Starting Courier IMAP-SSL server: imapd-ssl.<br /> <br />     bunker:~# /etc/init.d/mysql restart<br />     Stopping MySQL database server: mysqld.<br />     Starting MySQL database server: mysqld.<br /> <br />     bunker:~# /etc/init.d/postfix restart<br />     Stopping mail transport agent: Postfix.<br />     Starting mail transport agent: Postfix. <br /> <br /> mirem quins serveis tenim oberts a la nostre m&agrave;quina...<br /> <br />     bunker:~# nmap localhost<br /> <br />     Starting nmap V. 2.54BETA31 ( www.insecure.org/nmap/ )<br />     Interesting ports on localhost (127.0.0.1):<br />     (The 1549 ports scanned but not shown below are in state: closed)<br />     Port State Service<br />     25/tcp open smtp<br />     993/tcp open imaps<br /> <br />     Nmap run completed -- 1 IP address (1 host up) scanned in 0 seconds <br /> <br /> i bingo!!, nom&eacute;s el Postfix i el IMAP-SSL escoltant des de fora, a veure si el MySQL tamb&eacute; est&agrave; preparat...<br /> <br />     bunker:~# /etc/init.d/mysql status<br />     /usr/bin/mysqladmin Ver 8.23 Distrib 3.23.49, for pc-linux-gnu on i686<br />     Copyright (C) 2000 MySQL AB &amp; MySQL Finland AB &amp; TCX DataKonsult AB<br />     This software comes with ABSOLUTELY NO WARRANTY. This is free software,<br />     and you are welcome to modify and redistribute it under the GPL license<br /> <br />     Server version 3.23.49-log<br />     Protocol version 10<br />     Connection Localhost via UNIX socket<br />     UNIX socket /var/run/mysqld/mysqld.sock<br />     Uptime: 2 min 21 sec <br /> <br /> Jejeje tot pinta b&eacute;. Ja es podria dir que tot funciona, nom&eacute;s falta fer una cosa, una simple cosa que si ens la deixem ens donar&agrave; molts mal de caps...<br /> <br /> Hem d&#39;enviar un correu a cadascun dels usuaris que h&agrave;gim creat al sistema, ja que al rebre el correu, es crear&agrave; l&#39;estructura de directoris a /var/spool/mail, si no ho f&eacute;ssim, ens donaria error al voler accedir per IMAP al nostre servidor<br /> Un cop enviat el correu, si tot ha anat b&eacute; ens apareixer&agrave; una carpeta per a cada usuari a /var/spool/mail<br /> <br /> Per depurar tots els errors possibles, &eacute;s important que feu servir els logs. Pels qui no ho s&agrave;piguen estan a /var/log, tots els programes aniran afegint les seves l&iacute;nies als corresponents fitxers. El que es queda m&eacute;s curt en el tema &eacute;s el courier, i de veritat que es nota ;)<br /> <br /> I fins aqu&iacute; hem arribat!<br /> <br /> En principi ja est&agrave; la primera part del nostre servidor de correu. Ho he anat fent tot for&ccedil;a de mem&ograve;ria, per tant agrairia molt&iacute;ssim que la gent que el prov&eacute;s em coment&eacute;s si hi falta alguna cosa, si hi sobra o si no s&#39;ent&eacute;n.<br /> <br /> Molta sort a tothom!</li></div>
    
            </p>

            <h3>
                Categories:
                
        Articles, Servidor
    
            </h3>

            <hr />
            <h1>Comentaris</h1>
            <ul class="list-group">
                
        <li class="list-group-item comment">què en fem del mailman? 
molt bó l'article i molt útil
pel que veig, no cal disposar de mailman per fer la llista de correu
segons tu, oi? ;) el problema seria, com es pot actualitzar la llista que està posada a mysql? a través d'un php-mysql que miri dins de la munió d'adreces per trobar-ne una i esborrar-la?
i amb lo divertit que és que et surti [títol_de_la_llista_de_correu] ...
fins aviat!<p class="comment-author">Escrit al 2006-12-25 22:29:03 per Anònim</p></li><li class="list-group-item comment">RE: què en fem del mailman? 
Home, el mailman t'ofereix moltissimes opcions més!
Aquest article anomeno com fer una petita llista de distribució, però no se ni si és pot dir així, ja que en realitat l'unic que es fa, es associar una direcció de correu a moltes.
Depenent de les teves necessitats en tindràs prou, però és molt provable que hagis d'acavar instal·lant el mailman per a poder veure els correus vells, enviar notificacions, poder afegir denegar gent, etc.<p class="comment-author">Escrit al 2006-12-25 22:34:12 per whats_up</p></li><li class="list-group-item comment">domini Bones,
T'has currat una bona recerca!!
Just ahir parlàvem de fer un servidor de correu i potser web per al nostre Col·lectiu. Podriem instal·lar-hi una Debian amb aquests paquets i fer que tingues un domini @colectiu.com ???

Gràcies

albertsanchez@correucatala.com<p class="comment-author">Escrit al 2006-12-25 22:35:24 per Anònim</p></li><li class="list-group-item comment">Re: Postfix + Mysql + Courier- 
Res... nomes dir que he moltes felicitats que hagi fet aquest article. Em vaig estar mirant el de bulma, i no hi va pas haver collons de fer-ho anar amb aquella manera que explica allà.
Dec 19 18:26:34 debian postfix/smtpd[1523]: fatal: no SASL authentication mechanisms
i no hi havia pas maneres de sortir d'aquí, tot i que em vaig mirar mig internet xD<p class="comment-author">Escrit al 2006-12-25 22:36:04 per Anònim</p></li><li class="list-group-item comment">Re: Postfix + Mysql + Courier- No es mereixen, jo tb vaig patir lo meu per aconseguir muntar-m'ho a casa, i per això vaig fer l'article, pq no vaig trobar enlloc on expliquès bé com fer-ho :P

Sort!<p class="comment-author">Escrit al 2006-12-25 22:36:42 per whats_up</p></li>
    
            </ul>


            <a href="https://catux.org/post_list.html">
                <i class="fas fa-chevron-left"></i>
                Arxius
            </a>
        </div>

    </div>


    </div> <!-- /.container -->

    <footer class="bg-dark text-light py-4 mt-5 fixed-bottom">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <p class="mb-0">
                        <small><small>Tot el contingut de Catux està subjecte sota la nova versió de la llicència de
                        <a href="http://creativecommons.org/licenses/by/2.5/es/deed.ca" class="text-light">Creative Commons</a></small></small>
                    </p>
                </div>
                <div class="col-md-4 text-md-end">
                    <p class="mb-0">
                        <a href="https://github.com/catux" class="text-light me-3"><i class="fab fa-github"></i></a>
                        <a href="https://t.me/+UaRevB06YidmYTY0" class="text-light"><i class="fab fa-telegram"></i></a>
                    </p>
                </div>
            </div>
        </div>
    </footer>



</body>
</html>
